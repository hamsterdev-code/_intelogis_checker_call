"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã BotHub API
–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç –∑–≤–æ–Ω–∫–∞ –∏ –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
"""

import json
import sys
from openai import OpenAI
import httpx
import logging
from config import OPENAI_API_KEY, OPENAI_BASE_URL, OPENAI_MODEL, BASE_DIR

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    datefmt='%H:%M:%S'
)
logger = logging.getLogger("APITest")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ BotHub
http_client = httpx.Client(
    timeout=60.0,
    follow_redirects=True,
)
client = OpenAI(
    base_url=OPENAI_BASE_URL,
    api_key=OPENAI_API_KEY,
    http_client=http_client,
)

def load_scripts():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞ scripts.txt"""
    scripts_file = BASE_DIR / "scripts.txt"
    try:
        with open(scripts_file, 'r', encoding='utf-8') as f:
            return f.read()
    except Exception as e:
        logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞: {str(e)}")
        return ""

def analyze_call_text(text: str, team: str = "") -> dict:
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∑–≤–æ–Ω–∫–∞ —á–µ—Ä–µ–∑ BotHub AI
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏
    
    Args:
        text: –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–≤–æ–Ω–∫–∞
        team: –ö–æ–º–∞–Ω–¥–∞ –ª–æ–≥–∏—Å—Ç–∞ (–¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞)
    """
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã
    scripts_content = load_scripts()
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç —Å —É—á–µ—Ç–æ–º –∫–æ–º–∞–Ω–¥—ã –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
    team_info = f"\n–ö–æ–º–∞–Ω–¥–∞ –ª–æ–≥–∏—Å—Ç–∞: {team}" if team else ""
    scripts_section = f"\n\n–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏:\n{scripts_content}" if scripts_content else ""
    
    prompt = f"""
–¢—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ –ª–æ–≥–∏—Å—Ç–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞.
–¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Ä–∞–±–æ—á–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∑–≤–æ–Ω–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏. –≠—Ç–æ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π —Ä–∞–±–æ—á–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –¶–≠ (–ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è, –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞–º–∏ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –º–∞—Ä—à—Ä—É—Ç–æ–≤) –∏ –æ—Ü–µ–Ω–∏ –µ–≥–æ –ø–æ 4 –∫—Ä–∏—Ç–µ—Ä–∏—è–º.{team_info}

–¢–µ–∫—Å—Ç –∑–≤–æ–Ω–∫–∞:
{text}
{scripts_section}

‚ö†Ô∏è –í–ê–ñ–ù–û: –ë—É–¥—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–º –∏ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º! ‚ö†Ô∏è

–ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û –º–µ—Ç–∫—É "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ó–í–û–ù–û–ö", "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ì–£–î–û–ö", "–ó–í–û–ù–û–ö", "–ì–£–î–û–ö" –∏–ª–∏ –¢–û–õ–¨–ö–û –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–µ–∑ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è ("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å", "–ê–ª–ª–æ" –∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ) - –í–°–ï –ö–†–ò–¢–ï–†–ò–ò –î–û–õ–ñ–ù–´ –ë–´–¢–¨ 0.0!

–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –µ—Å—Ç—å –¥–∏–∞–ª–æ–≥, –≤–æ–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—Ç—ã, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ - —ç—Ç–æ –°–û–î–ï–†–ñ–ê–¢–ï–õ–¨–ù–´–ô –∑–≤–æ–Ω–æ–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "–ê–ª–ª–æ"!
–í —Ç–µ–∫—Å—Ç–µ –Ω–µ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –ø—É–Ω–∫—Ç—É–∞—Ü–∏—è, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, –±—ã–ª –ª–∏ –¥–∏–∞–ª–æ–≥ (–ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è –ø–æ–Ω—è—Ç—å). –∏–Ω–æ–≥–¥–∞ —É –ª—é–¥–µ–π –ø–ª–æ—Ö–æ–ª–π –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–≤–∞ —Ç–µ—Ä—è—é—Ç—å—Å—è.
–ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏:

1. **–ö—Ä–∏—Ç–µ—Ä–∏–π 1 (call_was_made)**: –ë—ã–ª –ª–∏ —Å–æ–≤–µ—Ä—à–µ–Ω –∑–≤–æ–Ω–æ–∫, –Ω–µ —è–≤–ª—è–ª—Å—è –ª–∏ –æ–Ω –ø—É—Å—Ç—ã–º?
   
   ‚ö†Ô∏è –í–ê–ñ–ù–û: –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ - –°–¢–ê–í–¨ 0.0! –≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç —É–∂–µ –ø—Ä–æ—à–µ–ª –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–æ –µ—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –æ–Ω –¥–æ—à–µ–ª –¥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ - —Å—Ç–∞–≤—å 0.0!
   
   ‚ö†Ô∏è –°–¢–ê–í–¨ 0.0 –¢–û–õ–¨–ö–û –ï–°–õ–ò:
   - –í —Ç–µ–∫—Å—Ç–µ 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ
   - –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ó–í–û–ù–û–ö", "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ì–£–î–û–ö", "–ó–í–û–ù–û–ö", "–ì–£–î–û–ö" –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ –º–µ—Ç–∫–∏
   - –¢–û–õ–¨–ö–û –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ë–ï–ó –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ" (–∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ), "–î–æ–±—Ä—ã–π –¥–µ–Ω—å" (–∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ), "–ê–ª–ª–æ" (–∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ)
   - –¢–æ–ª—å–∫–æ –∑–≤—É–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ –±–µ–∑ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
   - –¢–∏—à–∏–Ω–∞ –∏–ª–∏ –Ω–µ–∑–Ω–∞—á–∞—â–∏–µ –∑–≤—É–∫–∏
   
   ‚úÖ –°–¢–ê–í–¨ 1.0 –ï–°–õ–ò:
   - –í —Ç–µ–∫—Å—Ç–µ –ë–û–õ–¨–®–ï 5 —Å–ª–æ–≤ –ò –±—ã–ª —Ä–∞–∑–≥–æ–≤–æ—Ä
   - –ë—ã–ª –ª–∏ –¥–∏–∞–ª–æ–≥ –º–µ–∂–¥—É 2 –ª–∏—Ü–∞–º–∏
   - –û–±—Å—É–∂–¥–∞—é—Ç—Å—è –ª—é–±—ã–µ —Ç–µ–º—ã
   
   –ü–†–ò–ú–ï–†–´ –°–û–î–ï–†–ñ–ê–¢–ï–õ–¨–ù–û–ì–û –ó–í–û–ù–ö–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å—Ç–∞–≤—å 1.0):
   - "–ê–ª–ª–æ! –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –î–º–∏—Ç—Ä–∏–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á! –ú–µ–Ω—è –∑–æ–≤—É—Ç –õ—é–±–∞, –∫–æ–º–ø–∞–Ω–∏—è ¬´–í–µ–∂–µ —Ç–æ—Ç —Ä–∞–∑¬ª. –•–æ—Ç–µ–ª–∞ –±—ã –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –≤–∞–º–∏ –ø–æ –ø–æ–≤–æ–¥—É —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–µ–π—Å–æ–≤ —Å –õ–∏–ø–µ—Ü–∫–∞. –£ –Ω–∞—Å –ø—Ä–∏—à–ª–∞ —Ä–∞—Å—à–∏—Ä–æ—á–∫–∞, —Ç–∞–º –º–Ω–æ–≥–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–µ–π—Å–æ–≤ —Å –õ–∏–ø–µ—Ü–∫–∞ –Ω–∞ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä, –Ω–∞ –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –Ω–∞ –°–∞–º–∞—Ä—É..." ‚Üí 1.0 (–µ—Å—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö —Ç–µ–º - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–µ–π—Å—ã, –º–∞—Ä—à—Ä—É—Ç—ã)
   - "–ê–ª–ª–æ. –ë–æ—Ä–∏—Å, —è –≤–∞–º —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–≤–æ–Ω–∏–ª–∞, –Ω–µ —É—Ç–æ—á–Ω–∏–ª–∞ –≤–∞—à –∫–æ–¥ –í–∞—Ç–∏. –ß—Ç–æ-—Ç–æ —Å–ª—ã—à–Ω–æ –ø–ª–æ—Ö–æ. –ü–ª–æ—Ö–æ —Å–ª—ã—à–Ω–æ, –¥–∞? –ê –≤–∞—à –∫–æ–¥ –í–∞—Ç–∏ –º–æ–∂–µ—Ç–µ —Å–∫–∞–∑–∞—Ç—å? ... 2385, 525. –í—Å—ë, –ø–æ–Ω—è–ª–∞. –°–ø–∞—Å–∏–±–æ." ‚Üí 1.0 (–µ—Å—Ç—å –¥–∏–∞–ª–æ–≥, –≤–æ–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—Ç—ã, –æ–±–º–µ–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π)
   - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –≤–æ–ø—Ä–æ—Å –æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ/—É—Å–ª—É–≥–∞—Ö/–∫–æ–¥–∞—Ö/–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö + –æ—Ç–≤–µ—Ç (–¥–∞–∂–µ "–Ω–µ—Ç") + –æ–±—Å—É–∂–¥–µ–Ω–∏–µ = —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫ ‚Üí 1.0
   - –û–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, —É—Å–ª–æ–≤–∏–π, –∫–æ–¥–æ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ - –¥–∞–∂–µ –∫–æ—Ä–æ—Ç–∫–æ–µ, –Ω–æ —Å –æ–±–º–µ–Ω–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π = —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫ ‚Üí 1.0
   - –õ—é–±–æ–π –¥–∏–∞–ª–æ–≥, –≥–¥–µ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏ –æ—Ç–≤–µ—Ç—ã –æ—Ç –¥—Ä—É–≥–æ–≥–æ, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ç–µ–º—ã = —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫ ‚Üí 1.0
   - –±—Ä–∞—Ç–∞–Ω, –ø—Ä–∏–≤–µ—Ç –ø—Ä–æ–π–¥–µ—à—å –≥—É–ª—è—Ç—å? –¥–∞, –¥–∞–≤–∞–π. –≤ –ø–∞—Ä–∫–µ –≤ 18 —Ç–æ–≥–¥–∞? –æ–∫ => 1.0

2. **–ö—Ä–∏—Ç–µ—Ä–∏–π 2 (work_related)**: –ë—ã–ª –ª–∏ –∑–≤–æ–Ω–æ–∫ —Ä–µ–∞–ª—å–Ω–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ–º —Ä–∞–±–æ—á–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤?
   
   ‚ö†Ô∏è –í–ê–ñ–ù–û: –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ - –°–¢–ê–í–¨ 0.0! –≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç —É–∂–µ –ø—Ä–æ—à–µ–ª –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–æ –µ—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –æ–Ω –¥–æ—à–µ–ª –¥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ - —Å—Ç–∞–≤—å 0.0!
   
   ‚ö†Ô∏è –°–¢–ê–í–¨ 0.0 –¢–û–õ–¨–ö–û –ï–°–õ–ò:
   - –í —Ç–µ–∫—Å—Ç–µ 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ
   - –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ó–í–û–ù–û–ö", "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ì–£–î–û–ö" –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ –º–µ—Ç–∫–∏
   - –¢–û–õ–¨–ö–û –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–µ–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö —Ç–µ–º
   - –†–∞–∑–≥–æ–≤–æ—Ä —è–≤–Ω–æ –ª–∏—á–Ω—ã–π (—Å –¥—Ä—É–∑—å—è–º–∏, —Å–µ–º—å–µ–π, –Ω–µ —Å–≤—è–∑–∞–Ω —Å —Ä–∞–±–æ—Ç–æ–π)
   - –¢–æ–ª—å–∫–æ –∑–≤—É–∫–∏ –∑–≤–æ–Ω–∫–∞ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
   - –í —Ç–µ–∫—Å—Ç–µ –ù–ï–¢ —Å–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ä–∞–±–æ—Ç–æ–π –≤ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
   
   ‚úÖ –°–¢–ê–í–¨ 1.0 –ï–°–õ–ò:
   - –í —Ç–µ–∫—Å—Ç–µ –ë–û–õ–¨–®–ï 5 —Å–ª–æ–≤ –ò –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è —Ä–∞–±–æ—á–∏–µ –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π –∏ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞–º–∏
   - –í —Ç–µ–∫—Å—Ç–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–ª–æ–≤–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–±–æ—Ç–æ–π –≤ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ (—Ç—ã —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å —ç—Ç–∏ —Å–ª–æ–≤–∞ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É)
   - –û–±—Å—É–∂–¥–∞—é—Ç—Å—è —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
   - –ï—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —É—Å–ª—É–≥ –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã
   - –û–±—Å—É–∂–¥–∞—é—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞–º–∏, –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º, –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏, –∑–∞—è–≤–∫–∞–º–∏, –º–∞—Ä—à—Ä—É—Ç–∞–º–∏, —Ä–µ–π—Å–∞–º–∏, –≥–æ—Ä–æ–¥–∞–º–∏, –∫–æ–¥–∞–º–∏, –Ω–æ–º–µ—Ä–∞–º–∏, —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏
   - –û–±—Å—É–∂–¥–∞—é—Ç—Å—è: —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞, —Ç–∏–ø—ã –º–∞—à–∏–Ω (—Ç—Ä–∞–ª–ª—ã, —Ñ—É—Ä—ã, —Ç–µ–Ω—Ç—ã, —Ä–µ—Ñ—ã, –∏–∑–æ—Ç–µ—Ä–º—ã, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —Ç.–¥.)
   - –í–æ–ø—Ä–æ—Å—ã –æ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞—Ö, –¥–æ—Å—Ç–∞–≤–∫–µ, –ª–æ–≥–∏—Å—Ç–∏–∫–µ, –º–∞—Ä—à—Ä—É—Ç–∞—Ö, —Ä–µ–π—Å–∞—Ö
   - –û–±—Å—É–∂–¥–µ–Ω–∏–µ –≥—Ä—É–∑–æ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∑–∞—è–≤–æ–∫, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–∑–æ–∫, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —É—Å–ª—É–≥ –∫–æ–º–ø–∞–Ω–∏–∏
   - –í–æ–ø—Ä–æ—Å—ã –æ –Ω–∞–ª–∏—á–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö, —Ü–µ–Ω–∞—Ö, —Å—Ä–æ–∫–∞—Ö
   - –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫–æ–¥–æ–≤, –Ω–æ–º–µ—Ä–æ–≤, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ (–∫–æ–¥—ã –í–∞—Ç–∏, –Ω–æ–º–µ—Ä–∞ –∑–∞—è–≤–æ–∫, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ç.–¥.)
   - –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–µ–π—Å–æ–≤, –º–∞—Ä—à—Ä—É—Ç–æ–≤, –≥–æ—Ä–æ–¥–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è/–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
   - –õ—é–±—ã–µ —Ä–∞–±–æ—á–∏–µ –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∫–æ–º–ø–∞–Ω–∏–∏
   
   –í–ê–ñ–ù–û: –¢—ã –¥–æ–ª–∂–µ–Ω —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –µ—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ —Å–ª–æ–≤–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–±–æ—Ç–æ–π –≤ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏. –ï—Å–ª–∏ —Ç–∞–∫–∏–µ —Å–ª–æ–≤–∞ –µ—Å—Ç—å –∏ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã - —ç—Ç–æ –†–ê–ë–û–ß–ò–ô –∑–≤–æ–Ω–æ–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑–∞–ª—Å—è –∏–ª–∏ –æ—Ç–≤–µ—Ç–∏–ª –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ!
   
   –ü–†–ò–ú–ï–†–´ –†–ê–ë–û–ß–ï–ì–û –ó–í–û–ù–ö–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å—Ç–∞–≤—å 1.0):
   - "–ê–ª–ª–æ! –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –î–º–∏—Ç—Ä–∏–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á! –ú–µ–Ω—è –∑–æ–≤—É—Ç –õ—é–±–∞, –∫–æ–º–ø–∞–Ω–∏—è ¬´–í–µ–∂–µ —Ç–æ—Ç —Ä–∞–∑¬ª. –•–æ—Ç–µ–ª–∞ –±—ã –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –≤–∞–º–∏ –ø–æ –ø–æ–≤–æ–¥—É —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–µ–π—Å–æ–≤ —Å –õ–∏–ø–µ—Ü–∫–∞. –£ –Ω–∞—Å –ø—Ä–∏—à–ª–∞ —Ä–∞—Å—à–∏—Ä–æ—á–∫–∞, —Ç–∞–º –º–Ω–æ–≥–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–µ–π—Å–æ–≤ —Å –õ–∏–ø–µ—Ü–∫–∞ –Ω–∞ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä, –Ω–∞ –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –Ω–∞ –°–∞–º–∞—Ä—É, –Ω–∞ –ö–æ—Å—Ç—Ä–æ–º—É, –Ω–∞ –í–æ–ª–≥–æ–≥—Ä–∞–¥..." ‚Üí 1.0 (–æ–±—Å—É–∂–¥–∞—é—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–µ–π—Å—ã, –º–∞—Ä—à—Ä—É—Ç—ã, –≥–æ—Ä–æ–¥–∞ - —ç—Ç–æ —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –∏ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ–∫)
   - "–ê–ª–ª–æ. –ë–æ—Ä–∏—Å, —è –≤–∞–º —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–≤–æ–Ω–∏–ª–∞, –Ω–µ —É—Ç–æ—á–Ω–∏–ª–∞ –≤–∞—à –∫–æ–¥ –í–∞—Ç–∏. ... –ê –≤–∞—à –∫–æ–¥ –í–∞—Ç–∏ –º–æ–∂–µ—Ç–µ —Å–∫–∞–∑–∞—Ç—å? ... 2385, 525." ‚Üí 1.0 (–æ–±—Å—É–∂–¥–∞–µ—Ç—Å—è –∫–æ–¥ –í–∞—Ç–∏ - —Ä–∞–±–æ—á–∏–π –≤–æ–ø—Ä–æ—Å)
   - –û–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, —Ç–∏–ø–æ–≤ –º–∞—à–∏–Ω (—Ç—Ä–∞–ª–ª—ã, —Ç–µ–Ω—Ç—ã, —Ä–µ—Ñ—ã –∏ —Ç.–¥.) ‚Üí 1.0
   - –í–æ–ø—Ä–æ—Å—ã –æ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞—Ö, –¥–æ—Å—Ç–∞–≤–∫–µ, –ª–æ–≥–∏—Å—Ç–∏–∫–µ ‚Üí 1.0
   - –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫–æ–¥–æ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –Ω–æ–º–µ—Ä–æ–≤, —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ ‚Üí 1.0
   - –î–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑–∞–ª—Å—è –∏–ª–∏ –æ—Ç–≤–µ—Ç–∏–ª "–Ω–µ—Ç" - —ç—Ç–æ –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—á–∏–π –∑–≤–æ–Ω–æ–∫, –µ—Å–ª–∏ –æ–±—Å—É–∂–¥–∞–ª–∏—Å—å —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã! ‚Üí 1.0

3. **–ö—Ä–∏—Ç–µ—Ä–∏–π 3 (script_compliance)**: –ù–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤–µ–ª –¥–∏–∞–ª–æ–≥ –ø–æ —Å–∫—Ä–∏–ø—Ç—É - —Å—Ü–µ–Ω–∞—Ä–∏—é?
   
   ‚ö†Ô∏è –°–¢–ê–í–¨ 0.0 –¢–û–õ–¨–ö–û –ï–°–õ–ò:
   - –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ó–í–û–ù–û–ö", "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ì–£–î–û–ö" –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ –º–µ—Ç–∫–∏
   - –ï—Å–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–π 1 = 0.0 (–Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞) –∏–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–π 2 = 0.0 (–Ω–µ —Ä–∞–±–æ—á–∏–π –∑–≤–æ–Ω–æ–∫)
   - –°–∫—Ä–∏–ø—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω (–Ω–µ –∑–∞–¥–∞–Ω—ã –≤–∞–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ —Å–∫–∞–∑–∞–Ω–∞ –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
   
   ‚úÖ –û–¶–ï–ù–ò–í–ê–ô –°–ü–†–ê–í–ï–î–õ–ò–í–û:
   - –°—Ä–∞–≤–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º, –Ω–æ –±—É–¥—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º - –Ω–µ –≤—Å–µ –∑–≤–æ–Ω–∫–∏ –º–æ–≥—É—Ç –∏–¥–µ–∞–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—É
   - –û—Ü–µ–Ω–∏ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ:
     - 1.0 - –∏–¥–µ–∞–ª—å–Ω–æ (–≤—Å–µ —ç—Ç–∞–ø—ã —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–º–ø–∞–Ω–∏–∏, –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π, –∑–∞–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã —É—Å–ª—É–≥–∏, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –≤–µ–ª —Ä–∞–∑–≥–æ–≤–æ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞)
     - 0.8-0.9 - –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ—á—Ç–∏ –≤—Å–µ —ç—Ç–∞–ø—ã, –Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã)
     - 0.6-0.7 - —Ö–æ—Ä–æ—à–æ (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã, –Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω—ã –≤–∞–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –¥–µ—Ç–∞–ª–∏ —Å–∫—Ä–∏–ø—Ç–∞)
     - 0.4-0.5 - —Å—Ä–µ–¥–Ω–µ–µ (–≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å —Å–∫—Ä–∏–ø—Ç–∞, –ø—Ä–æ–ø—É—â–µ–Ω—ã –≤–∞–∂–Ω—ã–µ —ç—Ç–∞–ø—ã –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã)
     - 0.2-0.3 - –ø–ª–æ—Ö–æ (–≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∞–ª–∞—è —á–∞—Å—Ç—å —Å–∫—Ä–∏–ø—Ç–∞, –ø—Ä–æ–ø—É—â–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã)
     - 0.0 - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏: –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –∑–≤–æ–Ω–∫–∞, —Ç–µ–∫—Å—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ç–∫–∞, —Å–∫—Ä–∏–ø—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω
   
   –ü—Ä–æ–≤–µ—Ä—å:
   - –ë—ã–ª–æ –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–º–ø–∞–Ω–∏–∏?
   - –ë—ã–ª–æ –ª–∏ –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –∫–ª–∏–µ–Ω—Ç–∞?
   - –ë—ã–ª–∏ –ª–∏ –∑–∞–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞?
   - –ë—ã–ª–∏ –ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã —É—Å–ª—É–≥–∏/–∑–∞—è–≤–∫–∏?
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞?
   - –ë—ã–ª–∏ –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å–∫—Ä–∏–ø—Ç—É?
   
   –í–ê–ñ–ù–û: –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è, –æ–±—Å—É–¥–∏–ª —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã, –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å—ã - —ç—Ç–æ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞! –ù–µ —Å—Ç–∞–≤—å —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫—É—é –æ—Ü–µ–Ω–∫—É!

- **–ö—Ä–∏—Ç–µ—Ä–∏–π 4 (positive_outcome)**: –î–∏–∞–ª–æ–≥ –¥–æ—à–µ–ª –¥–æ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, —Ä–µ—à–∏–ª–∏ –ª–∏ –æ–Ω–∏ —á—Ç–æ-—Ç–æ, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–≤–æ–Ω–æ–∫, –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–∞—Ç—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è?

  ‚ö†Ô∏è –°–¢–ê–í–¨ 0.0 –ï–°–õ–ò:

  - –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ó–í–û–ù–û–ö", "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ì–£–î–û–ö" –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ –º–µ—Ç–∫–∏
  - –ï—Å–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–π 1 = 0.0 (–Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞) –∏–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–π 2 = 0.0 (–Ω–µ —Ä–∞–±–æ—á–∏–π –∑–≤–æ–Ω–æ–∫)
  - –î–∏–∞–ª–æ–≥ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ø–æ–∑–∏—Ç–∏–≤–Ω–æ (–Ω–µ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å, –æ—Ç–∫–∞–∑, –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å, –∫–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω)

  ‚úÖ –°–¢–ê–í–¨ 1.0 –ï–°–õ–ò:

  - –ë—ã–ª —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –∑–≤–æ–Ω–æ–∫ –ò –¥–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ø–æ–∑–∏—Ç–∏–≤–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫–∞–∑/–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞, –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –Ω–∞ –∑–≤–æ–Ω–æ–∫ –≤ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è, –ø–æ–ª—É—á–µ–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ)
  - –î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö, –∑–≤–æ–Ω–∫–∞—Ö, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏

5 –∫—Ä–∏—Ç–µ—Ä–∏–π: 
explanation: –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–≤–æ–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. —Å—Ç—Ä–æ—á–∫–∞, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ - 512 —Å–∏–º–æ–≤–æ–ª–æ–≤. –æ–±—ä—è—Å–Ω–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é, –ø–æ—á–µ–º—É –Ω–∞–ø–∏—Å–∞–ª –∏–º–µ–Ω–Ω–æ —ç—Ç—É —Ü–∏—Ñ—Ä—É.

‚ö†Ô∏è –§–ò–ù–ê–õ–¨–ù–û–ï –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï:

- –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ 5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ - –í–°–ï 4 –ö–†–ò–¢–ï–†–ò–Ø –î–û–õ–ñ–ù–´ –ë–´–¢–¨ 0.0!
- –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û –º–µ—Ç–∫—É —Ç–∏–ø–∞ "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ó–í–û–ù–û–ö", "–¢–ï–õ–ï–§–û–ù–ù–´–ô –ì–£–î–û–ö", "–ó–í–û–ù–û–ö", "–ì–£–î–û–ö" –∏–ª–∏ –¢–û–õ–¨–ö–û –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–µ–∑ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è - –í–°–ï 4 –ö–†–ò–¢–ï–†–ò–Ø –î–û–õ–ñ–ù–´ –ë–´–¢–¨ 0.0!
- –ù–û: –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –ë–û–õ–¨–®–ï 5 —Å–ª–æ–≤ –ò –ø–æ—Å–ª–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –µ—Å—Ç—å –¥–∏–∞–ª–æ–≥, –≤–æ–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—Ç—ã, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ - —ç—Ç–æ –°–û–î–ï–†–ñ–ê–¢–ï–õ–¨–ù–´–ô –∑–≤–æ–Ω–æ–∫! –ö—Ä–∏—Ç–µ—Ä–∏–π 1 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1.0!
- –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –ë–û–õ–¨–®–ï 5 —Å–ª–æ–≤ –ò –µ—Å—Ç—å —Å–ª–æ–≤–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–±–æ—Ç–æ–π –≤ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ—á–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏, –∏ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è —Ä–∞–±–æ—á–∏–µ —Ç–µ–º—ã - –∫—Ä–∏—Ç–µ—Ä–∏–π 2 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1.0!
- –ë—É–¥—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–º: —Å—Ç—Ä–æ–≥–∏–º –∫ –∫–æ—Ä–æ—Ç–∫–∏–º —Ç–µ–∫—Å—Ç–∞–º (5 —Å–ª–æ–≤ –∏–ª–∏ –º–µ–Ω—å—à–µ), –Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–º –∑–≤–æ–Ω–∫–∞–º!

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –¢—ã –û–ë–Ø–ó–ê–ù –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞!
–î–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –Ω–µ –º–æ–∂–µ—à—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø—Ä–∏—á–∏–Ω–µ, –≤–µ—Ä–Ω–∏ JSON —Å –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
{{
"criteria_1": 0.0,
"criteria_2": 0.0,
"criteria_3": 0.0,
"criteria_4": 0.0
}}

–í–µ—Ä–Ω–∏ –æ—Ç–≤–µ—Ç –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:
{{
"criteria_1": <—á–∏—Å–ª–æ 0.0 –∏–ª–∏ 1.0>,
"criteria_2": <—á–∏—Å–ª–æ 0.0 –∏–ª–∏ 1.0>,
"criteria_3": <—á–∏—Å–ª–æ –æ—Ç 0.00 –¥–æ 1.00>,
"criteria_4": <—á–∏—Å–ª–æ 0.0 –∏–ª–∏ 1.0>,
"explanation": str
}}

–ù–ï –ø–∏—à–∏ –Ω–∏–∫–∞–∫–∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, –∏–∑–≤–∏–Ω–µ–Ω–∏–π –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ - –¢–û–õ–¨–ö–û JSON!"""

    try:
        logger.info("–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ BotHub API...")
        logger.info(f"–ú–æ–¥–µ–ª—å: {OPENAI_MODEL}")
        logger.info(f"–î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: {len(text)} —Å–∏–º–≤–æ–ª–æ–≤")
        if team:
            logger.info(f"–ö–æ–º–∞–Ω–¥–∞: {team}")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        request_params = {
            "model": OPENAI_MODEL,
            "messages": [
                {
                    "role": "user",
                    "content": prompt
                }
            ]
        }
        
        # –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON mode (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
        try:
            request_params["response_format"] = {"type": "json_object"}
            logger.debug("–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JSON mode")
        except:
            pass
        
        response = client.chat.completions.create(**request_params)
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Ç–≤–µ—Ç
        if not response or not hasattr(response, 'choices') or not response.choices:
            logger.error("‚ùå –ü—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API")
            return None
        
        choice = response.choices[0]
        content = choice.message.content.strip()
        
        logger.info(f"–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –¥–ª–∏–Ω–æ–π {len(content)} —Å–∏–º–≤–æ–ª–æ–≤")
        logger.debug(f"–ü—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤): {content[:500]}")
        
        # –ü–∞—Ä—Å–∏–º JSON
        start_idx = content.find('{')
        end_idx = content.rfind('}') + 1
        
        if start_idx != -1 and end_idx > start_idx:
            json_str = content[start_idx:end_idx]
            result = json.loads(json_str)
        else:
            # –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            result = json.loads(content)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
        if not all(key in result for key in ["criteria_1", "criteria_2", "criteria_3", "criteria_4"]):
            logger.error("‚ùå –í –æ—Ç–≤–µ—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏")
            return None
        
        return result
        
    except json.JSONDecodeError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {str(e)}")
        logger.error(f"–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–≤–µ—Ç–∞: {content[:1000] if 'content' in locals() else 'N/A'}")
        return None
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return None


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("=" * 80)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï BOTHUB API")
    print("=" * 80)
    print(f"API URL: {OPENAI_BASE_URL}")
    print(f"–ú–æ–¥–µ–ª—å: {OPENAI_MODEL}")
    print("=" * 80)
    print()
    
    while True:
        print("\n" + "-" * 80)
        print("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
        print("-" * 80)
        
        # –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –∑–≤–æ–Ω–∫–∞
        print("\nüìù –¢–µ–∫—Å—Ç –∑–≤–æ–Ω–∫–∞ (–≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ 'exit' –¥–ª—è –≤—ã—Ö–æ–¥–∞):")
        print("   (–î–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π)")
        lines = []
        while True:
            line = input()
            if not line and lines:
                break
            if line.lower() == 'exit':
                print("–í—ã—Ö–æ–¥...")
                sys.exit(0)
            lines.append(line)
        text = '\n'.join(lines).strip()
        
        if not text:
            print("‚ö†Ô∏è –¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!")
            continue
        
        # –í–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        print("\nüë• –ö–æ–º–∞–Ω–¥–∞ –ª–æ–≥–∏—Å—Ç–∞ (–Ω–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å):")
        team = input().strip()
        
        # –ê–Ω–∞–ª–∏–∑
        print("\n" + "=" * 80)
        print("–ê–ù–ê–õ–ò–ó...")
        print("=" * 80)
        
        result = analyze_call_text(text, team=team)
        
        if result:
            print("\n‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:")
            print("-" * 80)
            print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π 1 (call_was_made):     {result.get('criteria_1', 'N/A')}")
            print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π 2 (work_related):       {result.get('criteria_2', 'N/A')}")
            print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π 3 (script_compliance):  {result.get('criteria_3', 'N/A')}")
            print(f"–ö—Ä–∏—Ç–µ—Ä–∏–π 4 (positive_outcome):   {result.get('criteria_4', 'N/A')}")
            
            if 'explanation' in result:
                print(f"\nüìã –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:")
                print(f"   {result['explanation']}")
            
            print("\nüìä JSON –æ—Ç–≤–µ—Ç:")
            print(json.dumps(result, ensure_ascii=False, indent=2))
        else:
            print("\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.")
        
        # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–ª–∏ –≤—ã–π—Ç–∏
        print("\n" + "-" * 80)
        continue_choice = input("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ? (y/n): ").strip().lower()
        if continue_choice != 'y':
            print("–í—ã—Ö–æ–¥...")
            break


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n–í—ã—Ö–æ–¥ –ø–æ Ctrl+C...")
        sys.exit(0)
    except Exception as e:
        logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        sys.exit(1)

